name: Cross-Platform Installation Tests

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

permissions:
  contents: read

jobs:
  test-platform-detection:
    runs-on: ubuntu-latest
    name: Test Platform Detection
    steps:
      - uses: actions/checkout@v4
      - name: Run platform tests
        run: |
          chmod +x scripts/*.sh
          ./scripts/detect-platform.sh
          ./scripts/test-platforms.sh
          ./scripts/test-release-assets.sh v1.0.2

  test-cross-platform:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest]
        include:
          - os: ubuntu-latest
            platform: linux-amd64
          - os: macos-latest  
            platform: macos-arm64
    name: Test ${{ matrix.os }}
    steps:
      - uses: actions/checkout@v4
      - name: Test platform detection
        run: |
          chmod +x scripts/detect-platform.sh
          detected=$(./scripts/detect-platform.sh)
          echo "Detected: $detected, Expected: ${{ matrix.platform }}"
          [ "$detected" = "${{ matrix.platform }}" ]
      - name: Test binary availability
        run: |
          url="https://github.com/saxyguy81/mcp-hub/releases/download/v1.0.2/mcpctl-${{ matrix.platform }}"
          curl -sSf -I "$url" >/dev/null
          echo "âœ… Binary available"
